let cart=document.getElementById("landing"),place_order_button=document.getElementById("place_order_button");function isNumber(a){return!isNaN(parseFloat(a))&&!isNaN(a-0)}function init(){let a=Object.keys(sessionStorage);for(let b=0;b<a.length;b++)addToCart(parseInt(a[b]));document.body.style.opacity="1"}function createCartBlock(a){let b=products[a],{name:c,image_path:d,price:e}=b,f=parseInt(sessionStorage.getItem(a.toString()));cart.innerHTML+=`<div id="cart-product-${a}" class="cart-product">
                        <img class="cart-image" src="${d}" alt="">
                        <div class="cart-product-info mx-4">
                            <p class="fw-bold">${c}</p>
                            <p class="fw-light">${e} руб.</p>
                            <ul id="quantity-selector" class="pagination mt-3">
                                <li style="cursor: pointer" class="page-item">
                                    <a onclick="decrementValue(${a});" class="page-link btn-primary">-</a>
                                </li>
                                <li class="page-item disabled">
                                    <input id="quantity-${a}" name="quantity-${a}" style="width: 60px; text-align: center"
                                           type="number" class="page-link btn-primary"
                                           value="${f}">
                                </li>
                                <li style="cursor: pointer" class="page-item">
                                    <a onclick="incrementValue(${a});" class="page-link btn-primary">+</a>
                                </li>
                            </ul>
                            <p id="final_product_price_${a}" class="fs-4">${f*e} рублей</p>
                            <button onclick="deleteFromCart(${a})" class="btn btn-outline-danger">Удалить из корзины</button>
                        </div>
                        <hr>
                    </div>`,updateCartPrice()}function deleteCartBlock(a){let b=document.getElementById(`cart-product-${a}`);b.parentNode.removeChild(b),updateCartPrice()}function addToCart(a){sessionStorage.getItem(a.toString())||sessionStorage.setItem(a.toString(),"1"),createCartBlock(a);let b=document.getElementById(`addToCart-${a}`);b.className="btn btn-danger",b.innerHTML="\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0438\u0437 \u043A\u043E\u0440\u0437\u0438\u043D\u044B",b.onclick=()=>{deleteFromCart(a)},place_order_button.className=isCartEmpty()?"btn btn-success disabled":"btn btn-success"}function deleteFromCart(a){sessionStorage.removeItem(a.toString()),deleteCartBlock(a);let b=document.getElementById(`addToCart-${a}`);b.className="btn btn-success",b.innerHTML="\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443",b.onclick=()=>{addToCart(a)},place_order_button.className=isCartEmpty()?"btn btn-success disabled":"btn btn-success"}function isCartEmpty(){let a=Object.keys(sessionStorage);return 0===a.length}function incrementValue(a){let b=parseInt(document.getElementById(`quantity-${a}`).value);b=isNaN(b)?1:b,b++,10<b?b=10:1>b&&(b=1),sessionStorage.setItem(a.toString(),b.toString()),document.getElementById(`quantity-${a}`).value=b;let c=document.getElementById(`final_product_price_${a}`);c.innerHTML=`${b*products[a].price} рублей`,updateCartPrice()}function decrementValue(a){let b=parseInt(document.getElementById(`quantity-${a}`).value);b=isNaN(b)?1:b,b--,10<b?b=10:1>b&&(b=1),sessionStorage.setItem(a.toString(),b.toString()),document.getElementById(`quantity-${a}`).value=b;let c=document.getElementById(`final_product_price_${a}`);c.innerHTML=`${b*products[a].price} рублей`,updateCartPrice()}function updateCartPrice(){let a=document.querySelectorAll("[id^=\"final_product_price_\"]"),b=0;for(let c,d=0;d<a.length;d++)c=parseInt(a[d].innerHTML.match(/\d{1,10}/)[0]),b+=c;let c=document.getElementById("final_price");c.innerHTML=`Итого: ${b} рублей`;let d=document.getElementById("cart_counter"),e=0,f=Object.keys(sessionStorage);for(let a=0;a<f.length;a++)e+=parseInt(sessionStorage.getItem(f[a]));d.innerHTML=e.toString()}function clearCart(){let a=Object.keys(sessionStorage);for(let b=0;b<a.length;b++)deleteFromCart(parseInt(a[b]))}function printSS(){let a=Object.keys(sessionStorage);for(let b=0;b<a.length;b++)console.log(`${a[b]} => ${sessionStorage.getItem(a[b])}\n`)}function generateModalContent(a){let{name:b,subtitle:c,price:d,description:e,image_path:f}=products[a],g=`<div class="modal-dialog modal-xl modal-fullscreen-lg-down modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="exampleModalLabel">Товар</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="cart-product-${a}" class="cart-product d-flex flex-column">
                    <div class="cart-product-info mx-4">
                        <p class="fw-bold">${b}</p>
                        <p class="fw-light">${c}</p>
                        <p class="fw-light">${d} руб.</p>
                        <p class="fst-italic">${e}</p>
                    </div>
                    <img style="padding: 20px" class="product-image" src="${f}" alt="">
                </div>
            </div>
            <div class="modal-footer">`;return g+=sessionStorage.getItem(a.toString())?`<button id="product-modal-button" onclick="buttonProductModal(${a});" class="btn btn-outline-danger">Удалить из корзины</button>`:`<button id="product-modal-button" onclick="buttonProductModal(${a});" class="btn btn-success">Добавить в корзину</button>`,g+=`<button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                    Закрыть
                </button>
            </div>
        </div>
    </div>`,g}function openProductModal(a){let b=document.getElementById("productModal");b.innerHTML=generateModalContent(a),$("#productModal").modal("show")}function buttonProductModal(a){let b=sessionStorage.getItem(a.toString());b?deleteFromCart(a):addToCart(a),$("#productModal").modal("hide")}function placeOrder(){let a=!1,b=$("#form-error")[0];b.className="alert alert-danger d-none";let c=$("#place-order-button")[0];c.disabled=!0;let d=$("#name")[0],e=$("#phone")[0],f=$("#address")[0],g=$("#comment")[0],h=[d,e,f,g],i=d.value,j=e.value,k=f.value,l=g.value;2>i.length?(b.innerHTML="\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u043A\u043E\u0440\u043E\u0442\u043A\u043E\u0435 \u0438\u043C\u044F! (\u041C\u0435\u043D\u0435\u0435 \u0434\u0432\u0443\u0445 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432)",a=!0):64<i.length&&(b.innerHTML="\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u0434\u043B\u0438\u043D\u043D\u043E\u0435 \u0438\u043C\u044F! (\u041F\u0440\u0435\u0432\u044B\u0448\u0430\u0435\u0442 64 \u0441\u0438\u043C\u0432\u043E\u043B\u0430)",a=!0),10>k.length&&(b.innerHTML="\u041D\u0435\u0442 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E\u0433\u043E \u0430\u0434\u0440\u0435\u0441\u0430 \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0438!",a=!0),j&&11===j.length||(b.innerHTML="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 \u0442\u0435\u043B\u0435\u0444\u043E\u043D (11 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432, \u043D\u0430\u0447\u0438\u043D\u0430\u0435\u0442\u0441\u044F \u0441 7 \u0438\u043B\u0438 8)",a=!0),256<l.length&&(b.innerHTML="\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u0434\u043B\u0438\u043D\u043D\u044B\u0439 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439! (\u0411\u043E\u043B\u0435\u0435 256 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432)",a=!0);let m=(i+j+k+l).toLowerCase();if((m.includes("drop database")||m.includes("drop table"))&&(b.innerHTML="\u041F\u0440\u043E\u0438\u0437\u043E\u043B\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u0438 \u0437\u0430\u043F\u0440\u043E\u0441\u0430!",a=!0),a)return b.className="alert alert-danger",void(c.disabled=!1);h.map(a=>(a.disabled=!0,a));let n="",o=Object.keys(sessionStorage);for(let a=0;a<o.length;a++)n+=`${o[a]}:${sessionStorage.getItem(o[a])};`;let p={name:i,address:k,phone:j,comm:l,cart:n};console.log(JSON.stringify(p)),$.post("/place_order_landing.php",{text:JSON.stringify(p)},function(a){if(isNumber(a)&&0!==parseInt(a)){b.className="alert alert-danger d-none";let c=parseInt(a),d=$("#order-id-text")[0];d.innerHTML=`Номер вашего заказа: ${c}`,$("#orderModal").modal("hide"),$("#orderResultModal").modal("show")}}),a&&(b.className="alert alert-danger"),b.innerHTML="\u041F\u0440\u043E\u0438\u0437\u043E\u043B\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u0438 \u0437\u0430\u043A\u0430\u0437\u0430!",h.map(a=>(a.value="",a.disabled=!1,a)),c.disabled=!1,clearCart()}function trackOrder(){let a=$("#tracking-body")[0],b=$("#tracking_code")[0];return isNumber(b.value)?void $.get("/tracking_landing.php",{id:b.value},function(b){a.innerHTML=b}):void(a.innerHTML="<div id=\"tracking_error\" class=\"alert alert-danger d-none\">\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u043D\u043E\u043C\u0435\u0440 \u0437\u0430\u043A\u0430\u0437\u0430!</div>")}